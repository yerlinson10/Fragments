<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fragments - Editor Visual</title>
  <link rel="stylesheet" href="editor-style.css" />
  <!-- Mermaid.js desde node_modules -->
  <script type="module">
    // Importar Mermaid directamente desde node_modules
    import mermaid from './node_modules/mermaid/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ 
      startOnLoad: false,
      theme: 'default',
      securityLevel: 'loose',
      flowchart: {
        useMaxWidth: false,
        htmlLabels: true,
        curve: 'basis',
        nodeSpacing: 60,
        rankSpacing: 80,
        padding: 25,
        diagramPadding: 20
      }
    });
    window.mermaid = mermaid;
  </script>
  <!-- Pan y Zoom para SVG -->
  <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
</head>
<body>
  <!-- Bot√≥n de tema -->
  <button id="themeToggle" class="theme-toggle" aria-label="Cambiar tema">
    üåô
  </button>

  <div class="editor-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>üìù Editor</h2>
        <button id="backBtn" class="btn-icon" title="Volver al selector">
          ‚¨ÖÔ∏è
        </button>
      </div>

      <div class="sidebar-menu">
        <button class="menu-item active" data-section="config">
          ‚öôÔ∏è Configuraci√≥n
        </button>
        <button class="menu-item" data-section="stats">
          üìä Stats
        </button>
        <button class="menu-item" data-section="flags">
          üö© Flags
        </button>
        <button class="menu-item" data-section="characters">
          üë• Personajes
        </button>
        <button class="menu-item" data-section="inventory">
          üéí Inventario
        </button>
        <button class="menu-item" data-section="events">
          üìñ Eventos
        </button>
        <button class="menu-item" data-section="endings">
          üèÅ Finales
        </button>
        <button class="menu-item" data-section="achievements">
          üèÜ Logros
        </button>
        <button class="menu-item" data-section="flowchart">
          üìä Flujo Visual
        </button>
      </div>

      <div class="sidebar-footer">
        <button id="saveBtn" class="btn-primary">
          üíæ Guardar
        </button>
        <button id="exportBtn" class="btn-secondary">
          üì§ Exportar
        </button>
        <button id="importBtn" class="btn-secondary">
          üì• Importar
        </button>
        <input type="file" id="importFile" accept=".json" style="display:none" />
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Toolbar -->
      <div class="toolbar">
        <div class="story-info">
          <h1 id="storyTitle">Nueva Historia</h1>
          <span id="storyStatus" class="status-badge">Sin guardar</span>
        </div>
        
        <div class="toolbar-actions">
          <button id="validateBtn" class="btn-secondary">
            ‚úì Validar
          </button>
          <button id="testBtn" class="btn-primary">
            ‚ñ∂Ô∏è Probar
          </button>
        </div>
      </div>

      <!-- Secciones del editor -->
      <div class="editor-sections">
        <!-- CONFIG SECTION -->
        <section id="config-section" class="editor-section active">
          <h2>‚öôÔ∏è Configuraci√≥n General</h2>
          
          <div class="form-grid">
            <div class="form-group">
              <label>ID de la Historia *</label>
              <input type="text" id="storyId" placeholder="mi_historia" required />
              <small>Solo letras min√∫sculas, n√∫meros y guiones bajos</small>
            </div>

            <div class="form-group">
              <label>Versi√≥n</label>
              <input type="text" id="storyVersion" placeholder="1.0.0" value="1.0.0" />
            </div>

            <div class="form-group full-width">
              <label>T√≠tulo de la Historia *</label>
              <input type="text" id="storyTitleInput" placeholder="Mi Historia Incre√≠ble" required />
            </div>

            <div class="form-group full-width">
              <label>Subt√≠tulo</label>
              <input type="text" id="storySubtitle" placeholder="Una aventura √©pica" />
            </div>

            <div class="form-group full-width">
              <label>Descripci√≥n</label>
              <textarea id="storyDescription" rows="3" placeholder="Descripci√≥n de la historia..."></textarea>
            </div>

            <div class="form-group">
              <label>Autor</label>
              <input type="text" id="storyAuthor" placeholder="Tu nombre" />
            </div>

            <div class="form-group">
              <label>Duraci√≥n (d√≠as)</label>
              <input type="number" id="storyDays" min="1" value="1" />
            </div>

            <div class="form-group">
              <label>D√≠a inicial</label>
              <input type="number" id="startingDay" min="1" value="1" />
            </div>

            <div class="form-group">
              <label>Hora inicial</label>
              <select id="startingTime">
                <option value="morning">Ma√±ana</option>
                <option value="afternoon">Tarde</option>
                <option value="evening">Noche</option>
              </select>
            </div>

            <div class="form-group">
              <label>Slots de guardado</label>
              <input type="number" id="saveSlots" min="1" max="10" value="3" />
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="autoSave" checked />
                Auto-guardado
              </label>
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="enableSound" checked />
                Sonidos
              </label>
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="showCharacters" />
                Mostrar personajes
              </label>
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="showInventory" />
                Mostrar inventario
              </label>
            </div>
          </div>
        </section>

        <!-- STATS SECTION -->
        <section id="stats-section" class="editor-section">
          <div class="section-header">
            <h2>üìä Estad√≠sticas</h2>
            <button class="btn-add" onclick="addStat()">+ Agregar Stat</button>
          </div>

          <div id="statsList" class="items-list">
            <!-- Se llenar√° din√°micamente -->
          </div>

          <div class="empty-message" id="statsEmpty">
            <p>No hay stats definidas. Las stats son valores num√©ricos que representan caracter√≠sticas del jugador (energ√≠a, carisma, etc.)</p>
          </div>
        </section>

        <!-- FLAGS SECTION -->
        <section id="flags-section" class="editor-section">
          <div class="section-header">
            <h2>üö© Flags (Variables)</h2>
            <button class="btn-add" onclick="addFlag()">+ Agregar Flag</button>
          </div>

          <div id="flagsList" class="items-list">
            <!-- Se llenar√° din√°micamente -->
          </div>

          <div class="empty-message" id="flagsEmpty">
            <p>No hay flags definidas. Las flags son variables booleanas, num√©ricas o de texto para controlar la historia.</p>
          </div>
        </section>

        <!-- CHARACTERS SECTION -->
        <section id="characters-section" class="editor-section">
          <div class="section-header">
            <h2>üë• Personajes</h2>
            <button class="btn-add" onclick="addCharacter()">+ Agregar Personaje</button>
          </div>

          <div id="charactersList" class="items-list">
            <!-- Se llenar√° din√°micamente -->
          </div>

          <div class="empty-message" id="charactersEmpty">
            <p>No hay personajes definidos. Los personajes pueden tener relaci√≥n con el jugador (-100 a +100).</p>
          </div>
        </section>

        <!-- INVENTORY SECTION -->
        <section id="inventory-section" class="editor-section">
          <div class="section-header">
            <h2>üéí Sistema de Inventario</h2>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="inventoryEnabled" />
                Habilitar inventario
              </label>
            </div>

            <div class="form-group">
              <label>Dinero inicial</label>
              <input type="number" id="initialMoney" min="0" value="0" />
            </div>
          </div>

          <div class="section-header">
            <h3>Items Disponibles</h3>
            <button class="btn-add" onclick="addItem()">+ Agregar Item</button>
          </div>

          <div id="itemsList" class="items-list">
            <!-- Se llenar√° din√°micamente -->
          </div>
        </section>

        <!-- EVENTS SECTION -->
        <section id="events-section" class="editor-section">
          <div class="section-header">
            <h2>üìñ Eventos</h2>
            <button class="btn-add" onclick="addEvent()">+ Agregar Evento</button>
          </div>

          <div class="events-toolbar">
            <input type="text" id="eventsSearch" placeholder="üîç Buscar evento..." />
            <select id="eventsFilter">
              <option value="all">Todos los eventos</option>
              <option value="mandatory">Obligatorios</option>
              <option value="optional">Opcionales</option>
              <option value="random">Aleatorios</option>
              <option value="forced">Forzados</option>
            </select>
            <select id="dayFilter">
              <option value="all">Todos los d√≠as</option>
            </select>
          </div>

          <div id="eventsList" class="events-list">
            <!-- Se llenar√° din√°micamente -->
          </div>

          <div class="empty-message" id="eventsEmpty">
            <p>No hay eventos creados. Los eventos son las situaciones narrativas donde el jugador toma decisiones.</p>
          </div>
        </section>

        <!-- ENDINGS SECTION -->
        <section id="endings-section" class="editor-section">
          <div class="section-header">
            <h2>üèÅ Finales</h2>
            <button class="btn-add" onclick="addEnding()">+ Agregar Final</button>
          </div>

          <div class="info-box">
            <strong>üí° Prioridades:</strong> Menor n√∫mero = m√°s espec√≠fico. El engine eval√∫a los finales de menor a mayor prioridad.
          </div>

          <div id="endingsList" class="items-list">
            <!-- Se llenar√° din√°micamente -->
          </div>

          <div class="empty-message" id="endingsEmpty">
            <p>No hay finales definidos. Los finales determinan c√≥mo termina la historia seg√∫n las decisiones del jugador.</p>
          </div>

          <div class="section-header">
            <h3>Final por Defecto</h3>
          </div>

          <div class="form-group">
            <label>T√≠tulo</label>
            <input type="text" id="defaultEndingTitle" placeholder="Un nuevo comienzo" />
          </div>

          <div class="form-group">
            <label>Mensaje</label>
            <textarea id="defaultEndingMessage" rows="4" placeholder="Tu historia termina aqu√≠..."></textarea>
          </div>
        </section>

        <!-- ACHIEVEMENTS SECTION -->
        <section id="achievements-section" class="editor-section">
          <div class="section-header">
            <h2>üèÜ Logros</h2>
            <button class="btn-add" onclick="addAchievement()">+ Agregar Logro</button>
          </div>

          <div id="achievementsList" class="items-list">
            <!-- Se llenar√° din√°micamente -->
          </div>

          <div class="empty-message" id="achievementsEmpty">
            <p>No hay logros definidos. Los logros son objetivos opcionales que los jugadores pueden desbloquear.</p>
          </div>
        </section>

        <!-- FLOWCHART SECTION -->
        <section id="flowchart-section" class="editor-section">
          <div class="section-header">
            <h2>üìä Flujo Visual de Historia</h2>
            <div style="display: flex; gap: 0.5rem;">
              <button class="btn-secondary btn-small" onclick="refreshFlowchart()">üîÑ Actualizar</button>
              <button class="btn-secondary btn-small" onclick="exportFlowchartCode()">ÔøΩ Ver C√≥digo</button>
            </div>
          </div>

          <!-- Controles y filtros -->
          <div class="flowchart-controls">
            <div class="form-group" style="margin: 0;">
              <label>Filtrar por d√≠a:</label>
              <select id="flowchartDayFilter" onchange="refreshFlowchart()">
                <option value="all">Todos los d√≠as</option>
              </select>
            </div>
            
            <div class="form-group" style="margin: 0;">
              <label>Tipo de evento:</label>
              <select id="flowchartTypeFilter" onchange="refreshFlowchart()">
                <option value="all">Todos los tipos</option>
                <option value="mandatory">Mandatory</option>
                <option value="optional">Optional</option>
                <option value="random">Random</option>
                <option value="forced">Forced</option>
              </select>
            </div>

            <div class="checkbox-label">
              <input type="checkbox" id="showUnreachable" onchange="refreshFlowchart()" checked />
              Mostrar eventos inalcanzables
            </div>
            
            <div class="checkbox-label">
              <input type="checkbox" id="showOnlyMandatory" onchange="refreshFlowchart()" />
              üéØ Solo eventos principales (Mandatory/Forced)
            </div>
            
            <div class="form-group" style="margin: 0;">
              <label>üîç Buscar evento:</label>
              <input type="text" id="flowchartSearch" placeholder="Buscar por texto o ID..." style="padding: 0.4rem;" onkeyup="handleFlowchartSearch()" />
            </div>
          </div>

          <!-- Leyenda -->
          <div class="flowchart-legend">
            <div class="legend-title">Leyenda:</div>
            <div class="legend-items">
              <div class="legend-item">
                <div class="legend-color" style="background: #4a90e2;"></div>
                <span>üîµ Mandatory</span>
              </div>
              <div class="legend-item">
                <div class="legend-color" style="background: #10b981;"></div>
                <span>üü¢ Optional</span>
              </div>
              <div class="legend-item">
                <div class="legend-color" style="background: #f59e0b;"></div>
                <span>üü° Random</span>
              </div>
              <div class="legend-item">
                <div class="legend-color" style="background: #8b5cf6;"></div>
                <span>üü£ Forced</span>
              </div>
              <div class="legend-item">
                <div class="legend-color" style="background: #ef4444;"></div>
                <span>üî¥ Inalcanzable</span>
              </div>
            </div>
            <div class="legend-items" style="margin-top: 0.5rem; border-top: 1px solid var(--border-light); padding-top: 0.5rem;">
              <div class="legend-item">
                <span>‚Üª Repetible</span>
              </div>
              <div class="legend-item">
                <span>üîí Con condiciones</span>
              </div>
              <div class="legend-item">
                <span>‚Üí Desbloquea</span>
              </div>
              <div class="legend-item">
                <span>-.-&gt; Bloquea</span>
              </div>
              <div class="legend-item">
                <span>‚ö° Requerido</span>
              </div>
              <div class="legend-item">
                <span>üéØ Por decisi√≥n</span>
              </div>
            </div>
          </div>

          <!-- Container para Mermaid -->
          <div class="flowchart-zoom-controls" style="margin-bottom: 1rem; display: flex; gap: 0.5rem; align-items: center;">
            <button class="btn-secondary btn-small" onclick="zoomIn()">üîç+ Acercar</button>
            <button class="btn-secondary btn-small" onclick="zoomOut()">üîç- Alejar</button>
            <button class="btn-secondary btn-small" onclick="resetZoom()">‚ü≤ Restablecer</button>
            <button class="btn-secondary btn-small" onclick="fitToScreen()">‚õ∂ Ajustar</button>
            <span id="zoomLevel" style="margin-left: 1rem; color: var(--text-secondary);">100%</span>
          </div>
          
          <div class="flowchart-container" id="flowchartWrapper" style="overflow: auto; width: 100%; max-height: 800px; border: 1px solid var(--border-light); border-radius: 8px; padding: 1rem; background: white; position: relative;">
            <div id="mermaidFlowchart"></div>
          </div>

          <!-- Panel de an√°lisis -->
          <div class="flowchart-analysis">
            <h3>üìà An√°lisis del Flujo</h3>
            <div id="flowchartStats" class="analysis-stats">
              <!-- Se llenar√° din√°micamente -->
            </div>
          </div>

          <div class="empty-message" id="flowchartEmpty">
            <p>No hay eventos para visualizar. Crea eventos en la secci√≥n üìñ Eventos.</p>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- Modales -->
  <!-- Modal de validaci√≥n -->
  <div id="validationModal" class="modal hidden">
    <div class="modal-content large">
      <h3>‚úì Resultados de Validaci√≥n</h3>
      <div id="validationResults"></div>
      <button class="btn-primary" onclick="closeModal('validationModal')">Cerrar</button>
    </div>
  </div>

  <!-- Modal de evento (edici√≥n) -->
  <div id="eventModal" class="modal hidden">
    <div class="modal-content xlarge">
      <h3 id="eventModalTitle">Editar Evento</h3>
      <div id="eventModalContent">
        <!-- Se llenar√° din√°micamente -->
      </div>
    </div>
  </div>

  <!-- Modal de confirmaci√≥n gen√©rico -->
  <div id="confirmModal" class="modal hidden">
    <div class="modal-content">
      <h3 id="confirmModalTitle">Confirmar</h3>
      <p id="confirmModalMessage"></p>
      <div class="modal-actions">
        <button id="confirmModalYes" class="btn-primary">Aceptar</button>
        <button id="confirmModalNo" class="btn-secondary">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal de input (reemplazo de prompt) -->
  <div id="inputModal" class="modal hidden">
    <div class="modal-content">
      <h3 id="inputModalTitle">Ingresa el valor</h3>
      <div class="form-group">
        <label id="inputModalLabel"></label>
        <input type="text" id="inputModalInput" class="modal-input" />
        <small id="inputModalHint"></small>
      </div>
      <div class="modal-actions">
        <button id="inputModalSubmit" class="btn-primary">Aceptar</button>
        <button id="inputModalCancel" class="btn-secondary">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal de formulario complejo -->
  <div id="formModal" class="modal hidden">
    <div class="modal-content large">
      <h3 id="formModalTitle">Formulario</h3>
      <div id="formModalContent" class="form-grid">
        <!-- Se llenar√° din√°micamente -->
      </div>
      <div class="modal-actions">
        <button id="formModalSubmit" class="btn-primary">Guardar</button>
        <button id="formModalCancel" class="btn-secondary">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal de selecci√≥n (select) -->
  <div id="selectModal" class="modal hidden">
    <div class="modal-content">
      <h3 id="selectModalTitle">Selecciona una opci√≥n</h3>
      <div class="form-group">
        <label id="selectModalLabel"></label>
        <select id="selectModalSelect" class="modal-select"></select>
      </div>
      <div class="modal-actions">
        <button id="selectModalSubmit" class="btn-primary">Aceptar</button>
        <button id="selectModalCancel" class="btn-secondary">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Stats -->
  <div id="statModal" class="modal hidden">
    <div class="modal-content large">
      <h3 id="statModalTitle">Agregar Estad√≠stica</h3>
      <div class="form-grid">
        <div class="form-group full-width">
          <label>ID de la estad√≠stica *</label>
          <input type="text" id="statKey" placeholder="energia, salud, dinero..." />
          <small>Solo letras min√∫sculas y guiones bajos</small>
        </div>
        <div class="form-group full-width">
          <label>Nombre visible *</label>
          <input type="text" id="statName" placeholder="Energ√≠a" />
        </div>
        <div class="form-group">
          <label>Icono (emoji)</label>
          <input type="text" id="statIcon" placeholder="‚ö°" />
        </div>
        <div class="form-group">
          <label>Valor m√≠nimo</label>
          <input type="number" id="statMin" value="0" />
        </div>
        <div class="form-group">
          <label>Valor m√°ximo</label>
          <input type="number" id="statMax" value="100" />
        </div>
        <div class="form-group">
          <label>Valor inicial</label>
          <input type="number" id="statStart" value="50" />
        </div>
      </div>
      <div class="modal-actions">
        <button id="statModalSave" class="btn-primary">Guardar</button>
        <button id="statModalCancel" class="btn-secondary">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Flags -->
  <div id="flagModal" class="modal hidden">
    <div class="modal-content">
      <h3 id="flagModalTitle">Agregar Variable</h3>
      <div class="form-grid">
        <div class="form-group full-width">
          <label>ID de la variable *</label>
          <input type="text" id="flagKey" placeholder="conoce_maria, dinero_extra..." />
          <small>Solo letras min√∫sculas y guiones bajos</small>
        </div>
        <div class="form-group full-width">
          <label>Tipo de variable *</label>
          <select id="flagType">
            <option value="boolean">Booleano (true/false)</option>
            <option value="number">N√∫mero</option>
            <option value="string">Texto</option>
          </select>
        </div>
        <div class="form-group full-width" id="flagValueGroup">
          <label id="flagValueLabel">Valor inicial</label>
          <input type="text" id="flagValue" />
        </div>
      </div>
      <div class="modal-actions">
        <button id="flagModalSave" class="btn-primary">Guardar</button>
        <button id="flagModalCancel" class="btn-secondary">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Characters -->
  <div id="characterModal" class="modal hidden">
    <div class="modal-content large">
      <h3 id="characterModalTitle">Agregar Personaje</h3>
      <div class="form-grid">
        <div class="form-group full-width">
          <label>ID del personaje *</label>
          <input type="text" id="characterKey" placeholder="maria, juan, antagonista..." />
          <small>Solo letras min√∫sculas y guiones bajos</small>
        </div>
        <div class="form-group full-width">
          <label>Nombre del personaje *</label>
          <input type="text" id="characterName" placeholder="Mar√≠a Gonz√°lez" />
        </div>
        <div class="form-group">
          <label>Icono (emoji)</label>
          <input type="text" id="characterIcon" placeholder="üë§" />
        </div>
        <div class="form-group">
          <label>Relaci√≥n inicial (-100 a 100)</label>
          <input type="number" id="characterRelationship" value="0" min="-100" max="100" />
        </div>
        <div class="form-group full-width">
          <label>
            <input type="checkbox" id="characterMet" />
            ¬øEl jugador ya conoce a este personaje?
          </label>
        </div>
      </div>
      <div class="modal-actions">
        <button id="characterModalSave" class="btn-primary">Guardar</button>
        <button id="characterModalCancel" class="btn-secondary">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Items -->
  <div id="itemModal" class="modal hidden">
    <div class="modal-content large">
      <h3 id="itemModalTitle">Agregar Objeto</h3>
      <div class="form-grid">
        <div class="form-group full-width">
          <label>ID del objeto *</label>
          <input type="text" id="itemKey" placeholder="llave, mapa, espada..." />
          <small>Solo letras min√∫sculas y guiones bajos</small>
        </div>
        <div class="form-group full-width">
          <label>Nombre del objeto *</label>
          <input type="text" id="itemName" placeholder="Llave oxidada" />
        </div>
        <div class="form-group full-width">
          <label>Icono (emoji)</label>
          <input type="text" id="itemIcon" placeholder="üîë" />
        </div>
        <div class="form-group full-width">
          <label>Descripci√≥n</label>
          <textarea id="itemDescription" rows="3" placeholder="Una vieja llave que parece abrir algo importante..."></textarea>
        </div>
      </div>
      <div class="modal-actions">
        <button id="itemModalSave" class="btn-primary">Guardar</button>
        <button id="itemModalCancel" class="btn-secondary">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Endings -->
  <div id="endingModal" class="modal hidden">
    <div class="modal-content xlarge">
      <h3 id="endingModalTitle">Agregar Final</h3>
      <div class="form-grid">
        <div class="form-group full-width">
          <label>ID del final *</label>
          <input type="text" id="endingId" placeholder="final_bueno, final_malo..." />
          <small>Solo letras min√∫sculas y guiones bajos</small>
        </div>
        <div class="form-group full-width">
          <label>T√≠tulo del final *</label>
          <input type="text" id="endingTitle" placeholder="Un nuevo comienzo" />
        </div>
        <div class="form-group">
          <label>Prioridad (menor = m√°s espec√≠fico)</label>
          <input type="number" id="endingPriority" value="100" min="1" max="999" />
          <small>Finales con menor prioridad se eval√∫an primero</small>
        </div>
        <div class="form-group full-width">
          <label>Mensaje *</label>
          <textarea id="endingMessage" rows="4" placeholder="Tu historia termina aqu√≠..."></textarea>
        </div>
        
        <!-- Condiciones visuales -->
        <div class="form-group full-width">
          <label>Condiciones para este final</label>
          <div class="conditions-builder">
            <!-- Stats -->
            <div class="condition-section">
              <h4>üìä Estad√≠sticas</h4>
              <div id="endingStatsConditions"></div>
              <button type="button" class="btn-secondary btn-small" onclick="addEndingStatCondition()">+ Agregar condici√≥n de stat</button>
            </div>
            
            <!-- Flags -->
            <div class="condition-section">
              <h4>üö© Variables</h4>
              <div id="endingFlagsConditions"></div>
              <button type="button" class="btn-secondary btn-small" onclick="addEndingFlagCondition()">+ Agregar condici√≥n de flag</button>
            </div>
            
            <!-- Characters -->
            <div class="condition-section">
              <h4>üë• Personajes</h4>
              <div id="endingCharactersConditions"></div>
              <button type="button" class="btn-secondary btn-small" onclick="addEndingCharacterCondition()">+ Agregar condici√≥n de personaje</button>
            </div>
            
            <!-- Day Range -->
            <div class="condition-section">
              <h4>üìÖ Rango de D√≠as</h4>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                <div>
                  <label>D√≠a m√≠nimo</label>
                  <input type="number" id="endingDayMin" min="0" placeholder="Desde d√≠a..." />
                </div>
                <div>
                  <label>D√≠a m√°ximo</label>
                  <input type="number" id="endingDayMax" min="0" placeholder="Hasta d√≠a..." />
                </div>
              </div>
            </div>
            
            <!-- Completed Events -->
            <div class="condition-section">
              <h4>‚úÖ Eventos Completados</h4>
              <div id="endingCompletedEventsConditions"></div>
              <button type="button" class="btn-secondary btn-small" onclick="addEndingCompletedEvent()">+ Agregar evento</button>
            </div>
            
            <!-- Previous Choices -->
            <div class="condition-section">
              <h4>üéØ Decisiones Previas</h4>
              <div id="endingPreviousChoicesConditions"></div>
              <button type="button" class="btn-secondary btn-small" onclick="addEndingPreviousChoice()">+ Agregar decisi√≥n</button>
            </div>
            
            <!-- Inventory -->
            <div class="condition-section">
              <h4>üí∞ Inventario</h4>
              <div>
                <label>Dinero m√≠nimo</label>
                <input type="number" id="endingMoneyMin" placeholder="Ej: 100" />
              </div>
              <div style="margin-top: 0.5rem;">
                <label>Items requeridos</label>
                <div id="endingRequiredItems"></div>
                <button type="button" class="btn-secondary btn-small" onclick="addEndingRequiredItem()">+ Agregar item</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button id="endingModalSave" class="btn-primary">Guardar</button>
        <button id="endingModalCancel" class="btn-secondary">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Achievements -->
  <div id="achievementModal" class="modal hidden">
    <div class="modal-content large">
      <h3 id="achievementModalTitle">Agregar Logro</h3>
      <div class="form-grid">
        <div class="form-group full-width">
          <label>ID del logro *</label>
          <input type="text" id="achievementKey" placeholder="primer_logro, explorador..." />
          <small>Solo letras min√∫sculas y guiones bajos</small>
        </div>
        <div class="form-group full-width">
          <label>Nombre del logro *</label>
          <input type="text" id="achievementName" placeholder="Primer Paso" />
        </div>
        <div class="form-group full-width">
          <label>Icono (emoji)</label>
          <input type="text" id="achievementIcon" placeholder="üèÜ" value="üèÜ" />
        </div>
        <div class="form-group full-width">
          <label>Descripci√≥n</label>
          <textarea id="achievementDescription" rows="3" placeholder="Completa tu primera decisi√≥n..."></textarea>
        </div>
      </div>
      <div class="modal-actions">
        <button id="achievementModalSave" class="btn-primary">Guardar</button>
        <button id="achievementModalCancel" class="btn-secondary">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Toast de notificaciones -->
  <div id="toast" class="toast hidden"></div>

  <script src="story-editor.js"></script>
</body>
</html>
